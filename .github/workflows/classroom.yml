name: Autograding Tests

on:
  push:
  repository_dispatch:

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Java 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # ---------- SAMPLE TEST CASES ----------

      - name: Sample 1
        id: t1
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Sample 1
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "220"
          expected-output: "Medium"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Sample 2
        id: t2
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Sample 2
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "400"
          expected-output: "Large"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      # ---------- HIDDEN TEST CASES ----------

      - name: Hidden 1
        id: t3
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 1
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "150"
          expected-output: "Small"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 2
        id: t4
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 2
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "350"
          expected-output: "Medium"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 3
        id: t5
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 3
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "200"
          expected-output: "Medium"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 4
        id: t6
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 4
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "199"
          expected-output: "Small"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 5
        id: t7
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 5
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "351"
          expected-output: "Large"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 6
        id: t8
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 6
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "0"
          expected-output: "Small"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 7
        id: t9
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 7
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "500"
          expected-output: "Large"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      - name: Hidden 8
        id: t10
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: Hidden 8
          setup-command: javac src/BrewSizeAdvisor.java
          command: java -cp src BrewSizeAdvisor
          input: "-201"
          expected-output: "Invalid Input"
          comparison-method: exact
          timeout: 10
          max-score: 10
          fail-on-error: true

      # ---------- FINAL REPORT ----------

      - name: Autograding Reporter
        if: success()
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          T1_RESULTS: ${{ steps.t1.outputs.result }}
          T2_RESULTS: ${{ steps.t2.outputs.result }}
          T3_RESULTS: ${{ steps.t3.outputs.result }}
          T4_RESULTS: ${{ steps.t4.outputs.result }}
          T5_RESULTS: ${{ steps.t5.outputs.result }}
          T6_RESULTS: ${{ steps.t6.outputs.result }}
          T7_RESULTS: ${{ steps.t7.outputs.result }}
          T8_RESULTS: ${{ steps.t8.outputs.result }}
          T9_RESULTS: ${{ steps.t9.outputs.result }}
          T10_RESULTS: ${{ steps.t10.outputs.result }}
        with:
          runners: t1,t2,t3,t4,t5,t6,t7,t8,t9,t10
          fail-on-error: true
